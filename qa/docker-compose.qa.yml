version: '3.8'

services:
  # QA Test Container - runs tests against existing services
  qa-tests:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: onboarding-qa-tests
    environment:
      - API_BASE_URL=http://host.docker.internal:3000
      - NODE_ENV=test
    volumes:
      # Mount reports directory to persist results
      - ./reports:/qa/reports
      # Mount tests for live updates during development
      - ./tests:/qa/tests
      - ./matrix:/qa/matrix
      - ./scripts:/qa/scripts
      # Mount parent directory to access service unit tests
      - ..:/workspace:ro
    working_dir: /qa
    extra_hosts:
      - "host.docker.internal:host-gateway"
    network_mode: bridge
